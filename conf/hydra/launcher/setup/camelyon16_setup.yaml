- set -e

- echo "Loading modules"
- source ${hydra.runtime.config_sources.1.path}/../load-asap.sh

# Multi-node copy util
- module unload UCX
- module load mpicopy

- echo "Setting environment variables"
- export OMP_NUM_THREADS=6
- export PYTHONFAULTHANDLER=1
- export NCCL_DEBUG=INFO
- export NCCL_ASYNC_ERROR_HANDLING=1

- if [[ -d ${oc.env:CAMELYON16_PATH} ]]; then
- echo "Detected folder ${oc.env:CAMELYON16_PATH}, skipping copy+setting symlink"
- ln -s ${oc.env:CAMELYON16_PATH} "$SCRATCH"/${path.stem:${oc.env:CAMELYON16_PATH}}
- elif [[ -f $PASSED ]]; then
- echo "Detected file ${oc.env:CAMELYON16_PATH}, assuming .tar; copy+untar"
- mpicopy -v "${oc.env:CAMELYON16_PATH}" -o "$SCRATCH"
- else
- echo "${oc.env:CAMELYON16_PATH} is not a valid file"
- exit 1
- fi

